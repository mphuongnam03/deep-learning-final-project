# ğŸ©º Há»‡ Thá»‘ng Cháº©n ÄoÃ¡n Bá»‡nh Lao Phá»•i (TB Detection System)

Há»‡ thá»‘ng AI phÃ¡t hiá»‡n vÃ  phÃ¢n loáº¡i bá»‡nh Lao Phá»•i tá»« áº£nh X-quang ngá»±c sá»­ dá»¥ng **Kiáº¿n TrÃºc Cascade 2 Giai Äoáº¡n** vá»›i YOLOv8.

## ğŸ“‹ Má»¥c Lá»¥c

- [Tá»•ng Quan](#-tá»•ng-quan)
- [Kiáº¿n TrÃºc Há»‡ Thá»‘ng](#-kiáº¿n-trÃºc-há»‡-thá»‘ng)
- [Cáº¥u TrÃºc ThÆ° Má»¥c](#-cáº¥u-trÃºc-thÆ°-má»¥c)
- [Pipeline Xá»­ LÃ½](#-pipeline-xá»­-lÃ½)
- [CÃ i Äáº·t](#-cÃ i-Ä‘áº·t)
- [HÆ°á»›ng Dáº«n Sá»­ Dá»¥ng](#-hÆ°á»›ng-dáº«n-sá»­-dá»¥ng)
- [Chi Tiáº¿t CÃ¡c Module](#-chi-tiáº¿t-cÃ¡c-module)

---

## ğŸ¯ Tá»•ng Quan

### BÃ i ToÃ¡n
PhÃ¡t hiá»‡n vÃ  phÃ¢n loáº¡i bá»‡nh Lao Phá»•i tá»« áº£nh X-quang ngá»±c thÃ nh **4 lá»›p**:
- `healthy` - Khá»e máº¡nh
- `sick_but_no_tb` - Bá»‡nh nhÆ°ng khÃ´ng pháº£i Lao
- `active_tb` - Lao hoáº¡t Ä‘á»™ng
- `latent_tb` - Lao tiá»m áº©n

### Giáº£i PhÃ¡p: Kiáº¿n TrÃºc Cascade 2 Giai Äoáº¡n

Do chá»‰ cÃ³ áº£nh TB má»›i cÃ³ bounding box, há»‡ thá»‘ng sá»­ dá»¥ng **Two-Stage Cascade Architecture**:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    GIAI ÄOáº N 1: PHÃ‚N LOáº I                       â”‚
â”‚                                                                 â”‚
â”‚   áº¢nh X-quang  â”€â”€â”€â–º  YOLOv8-cls  â”€â”€â”€â–º  4 lá»›p cháº©n Ä‘oÃ¡n         â”‚
â”‚                      (PhÃ¢n loáº¡i)       â”œâ”€â”€ healthy              â”‚
â”‚                                        â”œâ”€â”€ sick_but_no_tb       â”‚
â”‚                                        â”œâ”€â”€ active_tb â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚                                        â””â”€â”€ latent_tb â”€â”€â”€â”€â”€â”€â”¤    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”˜
                                                              â”‚
                                                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    GIAI ÄOáº N 2: PHÃT HIá»†N                       â”‚
â”‚                    (Chá»‰ cho TB dÆ°Æ¡ng tÃ­nh)                      â”‚
â”‚                                                                 â”‚
â”‚   áº¢nh TB  â”€â”€â”€â–º  YOLOv8-det  â”€â”€â”€â–º  Bounding Box tá»•n thÆ°Æ¡ng      â”‚
â”‚                 (PhÃ¡t hiá»‡n)       â”œâ”€â”€ active_tb lesions         â”‚
â”‚                                   â””â”€â”€ latent_tb lesions         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ— Kiáº¿n TrÃºc Há»‡ Thá»‘ng

Dá»± Ã¡n Ä‘Æ°á»£c xÃ¢y dá»±ng theo **Clean Architecture** vá»›i cÃ¡c táº§ng rÃµ rÃ ng:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         MAIN.PY (Entry Point)                      â”‚
â”‚                      CLI Interface & Orchestration                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      USE CASES LAYER                               â”‚
â”‚                  (Táº§ng Logic Nghiá»‡p Vá»¥)                            â”‚
â”‚                                                                    â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚ TBDiagnosisUseCase  â”‚    â”‚ DiagnosisResultExporter          â”‚  â”‚
â”‚   â”‚ - diagnose()        â”‚    â”‚ - to_json()                      â”‚  â”‚
â”‚   â”‚ - diagnose_batch()  â”‚    â”‚ - to_summary()                   â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     INTERFACES LAYER (Ports)                       â”‚
â”‚                   (Táº§ng Giao Diá»‡n Trá»«u TÆ°á»£ng)                      â”‚
â”‚                                                                    â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚ImageClassifierPortâ”‚  â”‚ObjectDetectorPortâ”‚  â”‚ImageAnnotatorPortâ”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   INFRASTRUCTURE LAYER (Adapters)                  â”‚
â”‚                  (Táº§ng Triá»ƒn Khai Cá»¥ Thá»ƒ)                          â”‚
â”‚                                                                    â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚ YOLOv8Classifier â”‚  â”‚ YOLOv8Detector   â”‚  â”‚ TBAnnotator     â”‚  â”‚
â”‚   â”‚ (4 lá»›p)          â”‚  â”‚ (2 lá»›p TB)       â”‚  â”‚ (Váº½ káº¿t quáº£)    â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        DOMAIN LAYER                                â”‚
â”‚                   (Táº§ng Thá»±c Thá»ƒ Cá»‘t LÃµi)                          â”‚
â”‚                                                                    â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ DiagnosisClass  â”‚  â”‚ BoundingBox     â”‚  â”‚ DiagnosisResult  â”‚   â”‚
â”‚   â”‚ (Enum 4 lá»›p)    â”‚  â”‚ (Tá»a Ä‘á»™ box)    â”‚  â”‚ (Káº¿t quáº£ tá»•ng há»£p)â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ Cáº¥u TrÃºc ThÆ° Má»¥c

```
ai4life/
â”‚
â”œâ”€â”€ ğŸ“„ main.py                    # Äiá»ƒm vÃ o chÃ­nh - CLI interface
â”œâ”€â”€ ğŸ“„ requirements.txt           # CÃ¡c thÆ° viá»‡n cáº§n thiáº¿t
â”œâ”€â”€ ğŸ“„ README.md                  # TÃ i liá»‡u dá»± Ã¡n (file nÃ y)
â”‚
â”œâ”€â”€ ğŸ“ src/                       # MÃ£ nguá»“n chÃ­nh
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ domain/                # Táº¦NG DOMAIN - Thá»±c thá»ƒ cá»‘t lÃµi
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ entities.py           # DiagnosisClass, BoundingBox, DiagnosisResult
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ interfaces/            # Táº¦NG INTERFACES - CÃ¡c cá»•ng trá»«u tÆ°á»£ng
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ ports.py              # ImageClassifierPort, ObjectDetectorPort, etc.
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ infrastructure/        # Táº¦NG INFRASTRUCTURE - Triá»ƒn khai cá»¥ thá»ƒ
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ yolo_adapters.py      # YOLOv8Classifier, YOLOv8Detector
â”‚   â”‚   â””â”€â”€ image_utils.py        # OpenCVImageLoader, TBAnnotator
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ usecases/              # Táº¦NG USE CASES - Logic nghiá»‡p vá»¥
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ diagnosis.py          # TBDiagnosisUseCase, DiagnosisResultExporter
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ data/                  # Tiá»n xá»­ lÃ½ dá»¯ liá»‡u
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ preprocessing.py      # TBDataPreprocessor
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ training/              # Huáº¥n luyá»‡n model
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ trainer.py            # TBModelTrainer
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ evaluation/            # ÄÃ¡nh giÃ¡ model
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ evaluator.py          # TBModelEvaluator
â”‚   â”‚   â””â”€â”€ heatmap.py            # TBHeatmapGenerator
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ config/                # Cáº¥u hÃ¬nh
â”‚   â”‚   â””â”€â”€ __init__.py
â”‚   â”‚
â”‚   â””â”€â”€ ğŸ“ utils/                 # Tiá»‡n Ã­ch chung
â”‚       â””â”€â”€ __init__.py
â”‚
â”œâ”€â”€ ğŸ“ tbx11k-simplified/         # Dataset TBX11K
â”‚   â”œâ”€â”€ data.csv                  # Metadata cá»§a dataset
â”‚   â”œâ”€â”€ images/                   # ThÆ° má»¥c chá»©a áº£nh
â”‚   â””â”€â”€ test/                     # áº¢nh test
â”‚
â”œâ”€â”€ ğŸ“ runs/                      # Káº¿t quáº£ huáº¥n luyá»‡n YOLO
â”œâ”€â”€ ğŸ“ tb_detection/              # Output model detection
â”œâ”€â”€ ğŸ“ tb_classification/         # Output model classification
â”œâ”€â”€ ğŸ“ results/                   # Káº¿t quáº£ Ä‘Ã¡nh giÃ¡
â”œâ”€â”€ ğŸ“ test_images/               # áº¢nh test thá»­ nghiá»‡m
â”‚
â””â”€â”€ ğŸ“ .venv/                     # MÃ´i trÆ°á»ng áº£o Python
```

---

## ğŸ”„ Pipeline Xá»­ LÃ½

### Pipeline Tá»•ng Quan

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         TRAINING PIPELINE                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ data.csv â”‚ â”€â”€â”€â–º â”‚ Tiá»n xá»­ lÃ½   â”‚ â”€â”€â”€â–º â”‚ Dataset YOLO Format       â”‚
     â”‚ + images â”‚      â”‚ (preprocess) â”‚      â”‚ â”œâ”€â”€ classification/       â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚ â”‚   â”œâ”€â”€ train/            â”‚
                                             â”‚ â”‚   â”‚   â”œâ”€â”€ healthy/      â”‚
                                             â”‚ â”‚   â”‚   â”œâ”€â”€ sick_but_no_tbâ”‚
                                             â”‚ â”‚   â”‚   â”œâ”€â”€ active_tb/    â”‚
                                             â”‚ â”‚   â”‚   â””â”€â”€ latent_tb/    â”‚
                                             â”‚ â”‚   â””â”€â”€ val/              â”‚
                                             â”‚ â””â”€â”€ detection/            â”‚
                                             â”‚     â”œâ”€â”€ images/           â”‚
                                             â”‚     â””â”€â”€ labels/           â”‚
                                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                          â”‚
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â–¼                            â–¼                â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
                    â”‚ Train YOLOv8-cls â”‚        â”‚ Train YOLOv8-det â”‚       â”‚
                    â”‚ (4 lá»›p)          â”‚        â”‚ (2 lá»›p TB)       â”‚       â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
                             â”‚                           â”‚                 â”‚
                             â–¼                           â–¼                 â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
                    â”‚ cls_best.pt      â”‚        â”‚ det_best.pt      â”‚       â”‚
                    â”‚ (Model phÃ¢n loáº¡i)â”‚        â”‚ (Model phÃ¡t hiá»‡n)â”‚       â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
                                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        INFERENCE PIPELINE                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  áº¢nh X-quang â”‚     â”‚            TBDiagnosisUseCase                  â”‚
   â”‚  (Input)     â”‚ â”€â”€â–º â”‚                                                â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
                        â”‚  â”‚ BÆ°á»›c 1: Táº£i & XÃ¡c thá»±c áº£nh              â”‚   â”‚
                        â”‚  â”‚         OpenCVImageLoader.load()         â”‚   â”‚
                        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                        â”‚                       â–¼                        â”‚
                        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
                        â”‚  â”‚ BÆ°á»›c 2: GIAI ÄOáº N 1 - PhÃ¢n loáº¡i         â”‚   â”‚
                        â”‚  â”‚         YOLOv8Classifier.classify()      â”‚   â”‚
                        â”‚  â”‚         â†’ 4 lá»›p (healthy/sick/active/    â”‚   â”‚
                        â”‚  â”‚           latent)                        â”‚   â”‚
                        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                        â”‚                       â–¼                        â”‚
                        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
                        â”‚  â”‚ BÆ°á»›c 3: Kiá»ƒm tra TB dÆ°Æ¡ng tÃ­nh?         â”‚   â”‚
                        â”‚  â”‚         DiagnosisClass.requires_detectionâ”‚   â”‚
                        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                        â”‚             â”‚ NO              â”‚ YES            â”‚
                        â”‚             â–¼                 â–¼                â”‚
                        â”‚        [Bá» qua]    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
                        â”‚                    â”‚ BÆ°á»›c 4: GIAI ÄOáº N 2   â”‚   â”‚
                        â”‚                    â”‚ YOLOv8Detector.detect()â”‚  â”‚
                        â”‚                    â”‚ â†’ Bounding boxes       â”‚   â”‚
                        â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                        â”‚                                â”‚               â”‚
                        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
                        â”‚  â”‚ BÆ°á»›c 5: ChÃº thÃ­ch áº£nh                   â”‚   â”‚
                        â”‚  â”‚         TBAnnotator.annotate()           â”‚   â”‚
                        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                        â”‚                       â–¼                        â”‚
                        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
                        â”‚  â”‚ BÆ°á»›c 6: Táº¡o DiagnosisResult             â”‚   â”‚
                        â”‚  â”‚         - predicted_class               â”‚   â”‚
                        â”‚  â”‚         - confidence                    â”‚   â”‚
                        â”‚  â”‚         - bounding_boxes (náº¿u TB)       â”‚   â”‚
                        â”‚  â”‚         - processing_time               â”‚   â”‚
                        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                             â”‚
                                             â–¼
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚               OUTPUT                           â”‚
                        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
                        â”‚  â”‚ JSON Report  â”‚  â”‚ áº¢nh Ä‘Ã£ chÃº thÃ­ch       â”‚  â”‚
                        â”‚  â”‚ - Cháº©n Ä‘oÃ¡n  â”‚  â”‚ - Banner phÃ¢n loáº¡i     â”‚  â”‚
                        â”‚  â”‚ - Tá»a Ä‘á»™ box â”‚  â”‚ - Bounding boxes       â”‚  â”‚
                        â”‚  â”‚ - Thá»i gian  â”‚  â”‚ - Äá»™ tin cáº­y           â”‚  â”‚
                        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âš™ï¸ CÃ i Äáº·t

### 1. YÃªu Cáº§u Há»‡ Thá»‘ng
- Python 3.10+
- CUDA (khuyáº¿n nghá»‹ cho GPU training)
- 8GB+ RAM

### 2. CÃ i Äáº·t MÃ´i TrÆ°á»ng

```bash
# Clone repository
git clone https://github.com/nemeryous/deep-learning-final-project.git
cd deep-learning-final-project

# Táº¡o mÃ´i trÆ°á»ng áº£o
python -m venv .venv

# KÃ­ch hoáº¡t mÃ´i trÆ°á»ng (Windows)
.venv\Scripts\activate

# KÃ­ch hoáº¡t mÃ´i trÆ°á»ng (Linux/Mac)
source .venv/bin/activate

# CÃ i Ä‘áº·t thÆ° viá»‡n
pip install -r requirements.txt
```

---

## ğŸš€ HÆ°á»›ng Dáº«n Sá»­ Dá»¥ng

### 1. Tiá»n Xá»­ LÃ½ Dá»¯ Liá»‡u

```bash
python main.py --mode preprocess \
    --csv tbx11k-simplified/data.csv \
    --images tbx11k-simplified/images \
    --output dataset
```

**Output:**
- `dataset/classification/` - Dataset cho phÃ¢n loáº¡i (4 lá»›p)
- `dataset/detection/` - Dataset cho phÃ¡t hiá»‡n (2 lá»›p TB)
- `dataset/dataset.yaml` - File cáº¥u hÃ¬nh YOLO

### 2. Huáº¥n Luyá»‡n Model

```bash
# Huáº¥n luyá»‡n model PhÃ¢n loáº¡i (4 lá»›p)
python main.py --mode train-cls --output dataset --epochs 100

# Huáº¥n luyá»‡n model PhÃ¡t hiá»‡n (2 lá»›p TB)
python main.py --mode train-det --output dataset --epochs 100

# Huáº¥n luyá»‡n cáº£ hai
python main.py --mode all --output dataset --epochs 100
```

### 3. Suy Luáº­n (Inference)

```bash
python main.py --mode inference \
    --image test_images/sample.png \
    --cls-model tb_classification/yolov8n_cls/weights/best.pt \
    --det-model tb_detection/yolov8n_tb/weights/best.pt \
    --conf 0.25 \
    --save-annotated \
    --output-json result.json
```

### 4. ÄÃ¡nh GiÃ¡ Model

```bash
python main.py --mode evaluate \
    --model best.pt \
    --output dataset
```

### 5. Táº¡o Heatmap

```bash
python main.py --mode heatmap --model best.pt
```

---

## ğŸ“¦ Chi Tiáº¿t CÃ¡c Module

### 1. Domain Layer (`src/domain/entities.py`)

| Class | MÃ´ táº£ |
|-------|-------|
| `DiagnosisClass` | Enum 4 lá»›p cháº©n Ä‘oÃ¡n (healthy, sick_but_no_tb, active_tb, latent_tb) |
| `BoundingBox` | Tá»a Ä‘á»™ vÃ¹ng tá»•n thÆ°Æ¡ng vá»›i Ä‘á»™ tin cáº­y |
| `ClassificationResult` | Káº¿t quáº£ tá»« Giai Ä‘oáº¡n 1 (phÃ¢n loáº¡i) |
| `DetectionResult` | Káº¿t quáº£ tá»« Giai Ä‘oáº¡n 2 (phÃ¡t hiá»‡n) |
| `DiagnosisResult` | Káº¿t quáº£ tá»•ng há»£p cuá»‘i cÃ¹ng |
| `ProcessingContext` | Theo dÃµi thá»i gian xá»­ lÃ½ |

### 2. Interfaces Layer (`src/interfaces/ports.py`)

| Interface | MÃ´ táº£ |
|-----------|-------|
| `ImageClassifierPort` | Giao diá»‡n cho model phÃ¢n loáº¡i |
| `ObjectDetectorPort` | Giao diá»‡n cho model phÃ¡t hiá»‡n |
| `ImageAnnotatorPort` | Giao diá»‡n cho váº½ chÃº thÃ­ch |
| `ImageLoaderPort` | Giao diá»‡n cho táº£i áº£nh |

### 3. Infrastructure Layer (`src/infrastructure/`)

| Class | File | MÃ´ táº£ |
|-------|------|-------|
| `YOLOv8Classifier` | `yolo_adapters.py` | Adapter YOLOv8-cls cho phÃ¢n loáº¡i 4 lá»›p |
| `YOLOv8Detector` | `yolo_adapters.py` | Adapter YOLOv8-det cho phÃ¡t hiá»‡n 2 lá»›p TB |
| `OpenCVImageLoader` | `image_utils.py` | Táº£i áº£nh báº±ng OpenCV |
| `TBAnnotator` | `image_utils.py` | Váº½ káº¿t quáº£ cháº©n Ä‘oÃ¡n lÃªn áº£nh |

### 4. Use Cases Layer (`src/usecases/diagnosis.py`)

| Class | MÃ´ táº£ |
|-------|-------|
| `TBDiagnosisUseCase` | Äiá»u phá»‘i pipeline Cascade 2 giai Ä‘oáº¡n |
| `DiagnosisResultExporter` | Xuáº¥t káº¿t quáº£ ra JSON, summary |

### 5. Data Layer (`src/data/preprocessing.py`)

| Class | MÃ´ táº£ |
|-------|-------|
| `TBDataPreprocessor` | Tiá»n xá»­ lÃ½ dataset, táº¡o cáº¥u trÃºc YOLO |

### 6. Training Layer (`src/training/trainer.py`)

| Class | MÃ´ táº£ |
|-------|-------|
| `TBModelTrainer` | Huáº¥n luyá»‡n model YOLOv8 vá»›i data augmentation |

### 7. Evaluation Layer (`src/evaluation/`)

| Class | File | MÃ´ táº£ |
|-------|------|-------|
| `TBModelEvaluator` | `evaluator.py` | ÄÃ¡nh giÃ¡ model trÃªn validation set |
| `TBHeatmapGenerator` | `heatmap.py` | Táº¡o heatmap trá»±c quan |

---

## ğŸ“Š Dataset

### TBX11K-Simplified

| Thá»‘ng kÃª | Sá»‘ lÆ°á»£ng |
|----------|----------|
| Tá»•ng sá»‘ áº£nh | 8,811 |
| Healthy | 3,800 |
| Sick but no TB | 3,800 |
| Active TB | 972 |
| Latent TB | 239 |
| áº¢nh cÃ³ bounding box | 1,211 (chá»‰ TB) |

---

## ğŸ¨ Káº¿t Quáº£ Trá»±c Quan

### MÃ£ MÃ u Cháº©n ÄoÃ¡n

| Lá»›p | MÃ u | Ã nghÄ©a |
|-----|-----|---------|
| `healthy` | ğŸŸ¢ Xanh lÃ¡ | Phá»•i khá»e máº¡nh |
| `sick_but_no_tb` | ğŸŸ¡ VÃ ng | CÃ³ bá»‡nh nhÆ°ng khÃ´ng pháº£i Lao |
| `active_tb` | ğŸ”´ Äá» | Lao phá»•i hoáº¡t Ä‘á»™ng |
| `latent_tb` | ğŸŸ  Cam | Lao phá»•i tiá»m áº©n |

---

## ğŸ‘¥ TÃ¡c Giáº£

- **Repository:** [deep-learning-final-project](https://github.com/nemeryous/deep-learning-final-project)
- **Branch:** main

---

## ğŸ“„ License

MIT License - Xem file [LICENSE](LICENSE) Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t.
